{
  "hash": "1b9ab902831e75656e52c88448f65bba",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: DuckDB + Ibis (Python)\nsubtitle: Use a dplyr-esque Python frontend\nexecute:\n  freeze: auto\n  cache: true\n---\n\n## Load libraries\n\n::: {#0c450a71 .cell cache='true' execution_count=1}\n``` {.python .cell-code}\nimport ibis\nimport ibis.selectors as s\nfrom ibis import _\n# ibis.options.interactive = True # enforce eager execution of queries\n```\n:::\n\n\n## Connect and register\n\n::: {#ff49f5de .cell execution_count=2}\n``` {.python .cell-code}\n## Instantiate an in-memory DuckDB connection from Ibis\ncon = ibis.duckdb.connect()\n\n## Register our parquet dataset as a table called \"nyc\" in our connection\ncon.register(\"nyc-taxi/**/*.parquet\", \"nyc\")\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">DatabaseTable: nyc\n  vendor_name           string\n  pickup_datetime       timestamp\n  dropoff_datetime      timestamp\n  passenger_count       int64\n  trip_distance         float64\n  pickup_longitude      float64\n  pickup_latitude       float64\n  rate_code             string\n  store_and_fwd         string\n  dropoff_longitude     float64\n  dropoff_latitude      float64\n  payment_type          string\n  fare_amount           float64\n  extra                 float64\n  mta_tax               float64\n  tip_amount            float64\n  tolls_amount          float64\n  total_amount          float64\n  improvement_surcharge float64\n  congestion_surcharge  float64\n  pickup_location_id    int64\n  dropoff_location_id   int64\n  month                 int64\n  year                  int64\n</pre>\n```\n:::\n:::\n\n\nAside: Remember that you can create a persistent, disk-backed database by giving it an\nappropriate name/path. This also enables out-of-core computation for bigger than RAM data.\n\n```py\n# con = ibis.duckdb.connect(\"nyc.dbb\")\n# con.register(\"nyc-taxi/**/*.parquet\", \"nyc\")\n# etc.\n```\n\nReference the table from Python. We'll call this reference object `nyc` too for consistency, but you could call it whatever you want (e.g., you could call it `nyc_ibis` to avoid potential ambiguity with the \"nyc\" table in our actual DuckDB connection).\nPrinting the object to screen will give us a lazy preview.\n\n::: {#23c1e7df .cell execution_count=3}\n``` {.python .cell-code}\n# con.list_tables() # Optional: confirm that our table is available\n\nnyc = con.table(\"nyc\")\nnyc\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">DatabaseTable: nyc\n  vendor_name           string\n  pickup_datetime       timestamp\n  dropoff_datetime      timestamp\n  passenger_count       int64\n  trip_distance         float64\n  pickup_longitude      float64\n  pickup_latitude       float64\n  rate_code             string\n  store_and_fwd         string\n  dropoff_longitude     float64\n  dropoff_latitude      float64\n  payment_type          string\n  fare_amount           float64\n  extra                 float64\n  mta_tax               float64\n  tip_amount            float64\n  tolls_amount          float64\n  total_amount          float64\n  improvement_surcharge float64\n  congestion_surcharge  float64\n  pickup_location_id    int64\n  dropoff_location_id   int64\n  month                 int64\n  year                  int64\n</pre>\n```\n:::\n:::\n\n\n## First example\n\n::: {#90e5931a .cell execution_count=4}\n``` {.python .cell-code}\nq1 = (\n  nyc\n  .group_by([\"passenger_count\"])\n  .agg(mean_tip = _.tip_amount.mean())\n)\n```\n:::\n\n\nTo see the underlying SQL translation, use `ibis.to_sql()`  \n\n::: {#e05d5b86 .cell execution_count=5}\n``` {.python .cell-code}\nibis.to_sql(q1)\n```\n\n::: {.cell-output .cell-output-display .cell-output-markdown execution_count=5}\n```sql\nSELECT\n  t0.passenger_count,\n  AVG(t0.tip_amount) AS mean_tip\nFROM main.nyc AS t0\nGROUP BY\n  1\n```\n:::\n:::\n\n\nTo actually execute the query and bring the result into Python, we can use the\n`execute()` method. By default this will coerce to a **pandas** DataFrame.\n\n::: {#5291ec7f .cell execution_count=6}\n``` {.python .cell-code}\ndat1 = q1.execute()\ndat1\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>passenger_count</th>\n      <th>mean_tip</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>0.862099</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>254</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>249</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>1.151011</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>247</td>\n      <td>2.300000</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>4</td>\n      <td>0.844519</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>3</td>\n      <td>0.962949</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>6</td>\n      <td>1.128365</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>5</td>\n      <td>1.102732</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>9</td>\n      <td>0.806800</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>177</td>\n      <td>1.000000</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>65</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>2</td>\n      <td>1.081580</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>208</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>10</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>7</td>\n      <td>0.544118</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>8</td>\n      <td>0.350769</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>66</td>\n      <td>1.500000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::{.callout-note}\n## Ibis conversion to polars\n\nThe `q1.execute()` method above is equivalent calling `q1.to_pandas()`. A\n`q1.to_polars()` equivalent [has been\nadded](https://github.com/ibis-project/ibis/pull/8478) to the dev version of\nIbis, but is not available with the latest offical release (8.0.0 at the time of\nwriting).\n:::\n\n### Digression: Interactive Ibis use and eager execution\n\nAt the very top of this document, I commented out the `ibis.options.interactive`\noption as part of my Ibis configuration. This was because I wanted to\ndemonstrate the default _deferred_ (i.e., lazy) behaviour of Ibis, which is just\nthe same as **d(b)plyr** in R. If you are building data wrangling pipelines, or\nwriting scripts with potentially complex queries, you probably want to\npreserve this deferred behaviour and avoid eager execution.\n\n_However_, there are times when you may want to default into eager execution. For example, if your dataset is of manageable size, or you are trying to iterate through different query operations... Or, you might just want to enable it so that you automatically get a nice print return object for your workshop materials. I'll adopt the latter view, so that I can quickly demonstrate some Ibis syntax and results for the rest of this document.\n\n::: {#94293361 .cell cache='false' execution_count=7}\n``` {.python .cell-code}\nibis.options.interactive = True\n```\n:::\n\n\nOkay, let's speed through some of the same basic queries that we've already seen\nin the DuckDB SQL and R (dplyr) pages. I won't bother to explain them in depth.\nJust consider them for demonstration purposes.\n\n## Aggregation\n\n::: {#90b24d26 .cell execution_count=8}\n``` {.python .cell-code}\n(\n  nyc\n  .group_by([\"passenger_count\", \"trip_distance\"])\n  .aggregate(\n    mean_tip = _.tip_amount.mean(),\n    mean_fare = _.fare_amount.mean()\n    )\n)\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"57c3760fed554064bd1070b238f1ea5e\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> passenger_count </span>┃<span style=\"font-weight: bold\"> trip_distance </span>┃<span style=\"font-weight: bold\"> mean_tip </span>┃<span style=\"font-weight: bold\"> mean_fare </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>   │\n├─────────────────┼───────────────┼──────────┼───────────┤\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.90</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.578975</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.687596</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.80</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.669911</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.652684</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.50</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.384175</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.883433</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.90</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.223380</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11.352555</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.77</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.499988</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.271770</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.90</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.911617</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.669678</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.00</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.516746</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14.098944</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.90</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.495665</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.764356</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.526552</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6.079754</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.90</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.783820</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.720520</span> │\n│               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────────────┴───────────────┴──────────┴───────────┘\n</pre>\n```\n:::\n:::\n\n\nNote that, even though we have enabled the interactive print mode, we still get\nlazy evalation if we assign a chain of query steps to an object (here: `q3`)...\n\n::: {#37b8ca9e .cell execution_count=9}\n``` {.python .cell-code}\nq3 = (\n  nyc\n  .group_by([\"passenger_count\", \"trip_distance\"])\n  .agg(\n    mean_tip = _.tip_amount.mean(),\n    mean_fare = _.fare_amount.mean()\n    )\n)\n```\n:::\n\n\n... but printing the query to screen enforces computation.\n\n::: {#8aa460dd .cell execution_count=10}\n``` {.python .cell-code}\nq3\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"e6e3fd9098bf4e41a217287d16ca9f06\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> passenger_count </span>┃<span style=\"font-weight: bold\"> trip_distance </span>┃<span style=\"font-weight: bold\"> mean_tip </span>┃<span style=\"font-weight: bold\"> mean_fare </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>   │\n├─────────────────┼───────────────┼──────────┼───────────┤\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.0</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.942336</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.932499</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10.8</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.808778</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">29.238556</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.0</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.250686</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11.611495</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.2</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.688208</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6.640748</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.3</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.720728</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6.941542</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.6</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.404022</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13.127911</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.1</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.545880</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14.321923</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.4</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.753561</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7.243111</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.3</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.171171</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.518436</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.0</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.810508</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.988705</span> │\n│               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────────────┴───────────────┴──────────┴───────────┘\n</pre>\n```\n:::\n:::\n\n\n## Pivot (reshape)\n\n::: {#41409b50 .cell execution_count=11}\n``` {.python .cell-code}\n# now chain on pivoting (and enforce computation via printing)\n(\n  q3\n  .pivot_longer(s.r[\"mean_tip\":\"mean_fare\"])\n)\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"387b26c981dc4cff81e0da8334100562\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> passenger_count </span>┃<span style=\"font-weight: bold\"> trip_distance </span>┃<span style=\"font-weight: bold\"> name      </span>┃<span style=\"font-weight: bold\"> value    </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>  │\n├─────────────────┼───────────────┼───────────┼──────────┤\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_tip </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.433840</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_fare</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.117718</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.8</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_tip </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.534714</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.8</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_fare</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.360443</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_tip </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.493234</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_fare</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.035307</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.3</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_tip </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.310850</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.3</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_fare</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.192242</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.8</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_tip </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.414165</span> │\n│               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.8</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">mean_fare</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.470059</span> │\n│               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────────────┴───────────────┴───────────┴──────────┘\n</pre>\n```\n:::\n:::\n\n\n## Joins (merges)\n\n(As we did in the **dplyr** code, we'll break this contrived join example into\ntwo steps)\n\n::: {#22450a01 .cell execution_count=12}\n``` {.python .cell-code}\nmean_tips = nyc.group_by(\"month\").agg(mean_tip = _.tip_amount.mean())\nmean_fares = nyc.group_by(\"month\").agg(mean_fare = _.fare_amount.mean())\n```\n:::\n\n\n::: {#834894e5 .cell execution_count=13}\n``` {.python .cell-code}\n(\n  mean_tips\n  .left_join(mean_fares, \"month\")\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> month </span>┃<span style=\"font-weight: bold\"> mean_tip </span>┃<span style=\"font-weight: bold\"> month_right </span>┃<span style=\"font-weight: bold\"> mean_fare </span>┃\n┡━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>   │\n├───────┼──────────┼─────────────┼───────────┤\n│    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.250903</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.270138</span> │\n│    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.281239</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.501252</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.036874</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9.942640</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.043167</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10.335490</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.007817</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9.813488</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.078014</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10.585157</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.254601</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.391198</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.059312</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10.379943</span> │\n│     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.079521</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10.492650</span> │\n│    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.237651</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12.313953</span> │\n│     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────┴──────────┴─────────────┴───────────┘\n</pre>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "duckdb-ibis_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script src=\"https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js\" crossorigin=\"anonymous\"></script>\n"
      ],
      "include-after-body": [
        "<script type=application/vnd.jupyter.widget-state+json>\n{\"state\":{\"02ee9849655b4f51b4c79734585c6f2d\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":\"auto\"}},\"0e533a3d1e184de9bdbfd26bf84edfec\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":\"auto\"}},\"29ea437e3a19447498f41e4ed1321508\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ProgressStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ProgressStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"bar_color\":\"black\",\"description_width\":\"\"}},\"387b26c981dc4cff81e0da8334100562\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FloatProgressModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FloatProgressModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ProgressView\",\"bar_style\":\"\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_84cab977d863443b9904eb8ec712dde8\",\"max\":100,\"min\":0,\"orientation\":\"horizontal\",\"style\":\"IPY_MODEL_bb6685ab8fb042c29bdfb6f7ab126466\",\"tabbable\":null,\"tooltip\":null,\"value\":100}},\"57c3760fed554064bd1070b238f1ea5e\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FloatProgressModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FloatProgressModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ProgressView\",\"bar_style\":\"\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_0e533a3d1e184de9bdbfd26bf84edfec\",\"max\":100,\"min\":0,\"orientation\":\"horizontal\",\"style\":\"IPY_MODEL_29ea437e3a19447498f41e4ed1321508\",\"tabbable\":null,\"tooltip\":null,\"value\":100}},\"798a3297d326439997c48efc21c48643\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ProgressStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ProgressStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"bar_color\":\"black\",\"description_width\":\"\"}},\"84cab977d863443b9904eb8ec712dde8\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":\"auto\"}},\"bb6685ab8fb042c29bdfb6f7ab126466\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ProgressStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ProgressStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"bar_color\":\"black\",\"description_width\":\"\"}},\"e6e3fd9098bf4e41a217287d16ca9f06\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FloatProgressModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FloatProgressModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ProgressView\",\"bar_style\":\"\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_02ee9849655b4f51b4c79734585c6f2d\",\"max\":100,\"min\":0,\"orientation\":\"horizontal\",\"style\":\"IPY_MODEL_798a3297d326439997c48efc21c48643\",\"tabbable\":null,\"tooltip\":null,\"value\":100}}},\"version_major\":2,\"version_minor\":0}\n</script>\n"
      ]
    }
  }
}